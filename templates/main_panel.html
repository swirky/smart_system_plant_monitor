{% extends "base.html" %}

{%block title%} Panel główny {%endblock%}

{% block content %}
    <h1>Panel główny</h1>
    <p>Inteligentny System Monitorowania Roślin</p>
    
    <div class="container mt-5">
        <div class="row" id="sortable-grid">
            <!-- Bloczek 1 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Natężenie światła</h4>
                    <p id="Light_Sensor_1_light_intensity">--</p><span>lx</span>
                    
                </div>
            </div>
            
            <!-- Bloczek 2 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura gleby - czujnik 1</h4>
                    <p id="Soil_Temperature_Sensor_1_soil_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 3 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura gleby - czujnik 2</h4>
                    <p id="Soil_Temperature_Sensor_2_soil_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 4 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura powietrza</h4>
                    <p id="Air_Temperature_and_Humidity_Sensor_1_air_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 5 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Wilgotność powietrza</h4>
                    <p id="Air_Temperature_and_Humidity_Sensor_1_air_humidity">--</p><span>%</span>
                </div>
            </div>
            
            <!-- Bloczek 6 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>WIlgotność gleby</h4>
                    <p id="Soil_Humidity_Sensor_1_soil_humidity">--</p><span>units</span>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
<script>
        document.addEventListener("DOMContentLoaded", function() {
        async function fetchSensorData() {
            try {
                const response = await fetch('/api/sensor_data');
                if (!response.ok) throw new Error("Błąd pobierania danych z serwera");
                const data = await response.json();

                // Iteracja przez wszystkie czujniki
                for (const [sensorName, measurements] of Object.entries(data)) {
                    for (const [measurementType, value] of Object.entries(measurements)) {
                        const elementId = `${sensorName.replace(/\s+/g, '_')}_${measurementType.replace(/\s+/g, '_')}`;
                        const element = document.getElementById(elementId);
                        if (element) {
                            element.innerText = value; // Aktualizacja wartości
                        }
                    }
                }
            } catch (error) {
                console.error("Błąd podczas pobierania danych:", error);
            }
        }

        // Odświeżaj dane co 10 sekund
        setInterval(fetchSensorData, 10000);
        fetchSensorData();
    });
</script>
{% endblock %}