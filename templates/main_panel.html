{% extends "base.html" %}

{%block title%} Panel główny {%endblock%}

{% block content %}
    <h1>Panel główny</h1>
    <p>Inteligentny System Monitorowania Roślin</p>
    <div class="container mt-5">
        <h2>Bieżąca data i czas:</h2>
        <p id="current-time" style="font-size: 1.5rem; font-weight: bold;">--:--:--</p>
    </div>
    
    <div class="container mt-5">
        <div class="row" id="sortable-grid">
            <!-- Bloczek 1 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Natężenie światła</h4>
                    <p id="Light_Sensor_1_light_intensity">--</p><span>lx</span>
                    
                </div>
            </div>
            
            <!-- Bloczek 2 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura gleby - czujnik 1</h4>
                    <p id="Soil_Temperature_Sensor_1_soil_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 3 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura gleby - czujnik 2</h4>
                    <p id="Soil_Temperature_Sensor_2_soil_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 4 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Temperatura powietrza</h4>
                    <p id="Air_Temperature_and_Humidity_Sensor_1_air_temperature">--</p><span>°C</span>
                </div>
            </div>
            
            <!-- Bloczek 5 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>Wilgotność powietrza</h4>
                    <p id="Air_Temperature_and_Humidity_Sensor_1_air_humidity">--</p><span>%</span>
                </div>
            </div>
            
            <!-- Bloczek 6 -->
            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex justify-content-center">
                <div class="sensor-card bg-light p-3 text-center">
                    <h4>WIlgotność gleby</h4>
                    <p id="Soil_Humidity_Sensor_1_soil_humidity">--</p><span>units</span>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Połączenie z serwerem za pomocą SSE
        const eventSource = new EventSource('/stream');

        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data); // Parsowanie danych JSON
            console.log(data); // Wyświetlanie danych w konsoli (tylko do debugowania)

            // Iteracja przez dane czujników
            for (const [sensorName, measurements] of Object.entries(data)) {
                for (const [measurementType, value] of Object.entries(measurements)) {
                    const elementId = `${sensorName.replace(/\s+/g, '_')}_${measurementType.replace(/\s+/g, '_')}`;
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.innerText = value; // Aktualizacja wartości w odpowiednim elemencie
                    }
                }
            }
        };

        eventSource.onerror = function(error) {
            console.error("Błąd w połączeniu SSE:", error);
        };

        function updateTime() {
        const now = new Date();
        const formattedTime = now.toLocaleString('pl-PL', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('current-time').innerText = formattedTime;
    }

    // Aktualizuj czas co sekundę
    setInterval(updateTime, 1000);

    // Wywołaj funkcję natychmiast
    updateTime();
    });
</script>
{% endblock %}